{% extends "base.html" %}
{% block title %}Students in Section for {{ course.name }} - Period: {{ instance.period }}{% endblock %}
{% block content %}
<h2>Students Enrolled in Section {{ section.number }} - Period: {{ instance.period }}</h2>
<a href="{{ url_for('list_sections', instance_id=instance.id) }}" class="btn btn-secondary mb-3">Back to Sections</a>

{% with messages = get_flashed_messages() %}
  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-info">{{ message }}</div>
    {% endfor %}
  {% endif %}
{% endwith %}

<div class="card mb-4">
  <div class="card-header bg-light">
    <h5>Enroll New Student</h5>
  </div>
  <div class="card-body">
    <form action="{{ url_for('enroll_student_in_section', section_id=section.id) }}" method="post" class="row g-3 align-items-end">
      <div class="col-md-8">
        <label for="user_id" class="form-label">Select Student</label>
        <select name="user_id" id="user_id" class="form-select" required>
          <option value="">Choose a student...</option>
          {% for student in students %}
            {% if student.id|string not in enrolled_student_ids %}
              <option value="{{ student.id }}">{{ student.name }} ({{ student.email }})</option>
            {% endif %}
          {% endfor %}
        </select>
      </div>
      <div class="col-md-4">
        <button type="submit" class="btn btn-success">Enroll Student</button>
      </div>
    </form>
  </div>
</div>

<div class="card">
  <div class="card-header bg-light">
    <h5>Currently Enrolled Students</h5>
  </div>
  <div class="card-body">
    {% if enrollments %}
      <table class="table table-bordered">
        <thead>
          <tr>
            <th>Student Name</th>
            <th>Email</th>
            <th>Final Grade</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for enrollment in enrollments %}
          <tr>
            <td>{{ enrollment.user_name }}</td>
            <td>{{ enrollment.user_email }}</td>
            <td>{{ enrollment.final_grade }}</td>
            <td>
              <form action="{{ url_for('unenroll_student_from_section', section_id=section.id, user_id=enrollment.user_id) }}" method="post" style="display:inline;">
                <button type="submit" class="btn btn-danger btn-sm">Unenroll</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <div class="alert alert-info">No students currently enrolled in this section.</div>
    {% endif %}
  </div>
</div>
{% endblock %}