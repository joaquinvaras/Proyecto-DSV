{% extends "base.html" %}

{% block title %}Sections for {{ course.name }}{% endblock %}

{% block content %}
<h2>Sections for {{ course.name }} (NRC: {{ course.nrc }})</h2>

<a href="{{ url_for('create_section', course_id=course.id) }}" class="btn btn-primary mb-3">Create Section</a>
<a href="{{ url_for('list_courses') }}" class="btn btn-secondary mb-3">Back to Courses</a>

<table class="table table-bordered">
    <thead>
        <tr>
            <th>Period</th>
            <th>Number</th>
            <th>Professor</th>
            <th>Section Format</th>
            <th>Topics</th>
            <th>Actions</th>
            <th>Enroll Students</th>
        </tr>
    </thead>
    <tbody>
        {% for section in sections %}
        <tr>
            <td>{{ section.period }}</td>
            <td>{{ section.number }}</td>
            <td>{{ section.professor_name }}</td>
            <td>
                {% if section.weight_or_percentage %}
                    <span class="badge bg-primary">Percentage-based</span>
                {% else %}
                    <span class="badge bg-secondary">Weight-based</span>
                {% endif %}
            </td>
            <td>
                {% for topic in section.topics %}
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 5px;">
                        <div>
                            {% if section.weight_or_percentage %}
                                {{ topic.name }}: {{ topic.value }}% 
                                <small>
                                    (Activities: 
                                    {% if topic.weight_or_percentage %}
                                        <span class="badge bg-primary">%</span>
                                    {% else %}
                                        <span class="badge bg-secondary">weight</span>
                                    {% endif %}
                                    )
                                </small>
                            {% else %}
                                {{ topic.name }}: {{ topic.value }}
                                <small>
                                    (Activities: 
                                    {% if topic.weight_or_percentage %}
                                        <span class="badge bg-primary">%</span>
                                    {% else %}
                                        <span class="badge bg-secondary">weight</span>
                                    {% endif %}
                                    )
                                </small>
                            {% endif %}
                        </div>
                        <div style="display: flex; gap: 5px;">
                            <a href="{{ url_for('edit_topic', id=topic.id) }}" class="btn btn-sm btn-outline-primary">Edit</a>
                            
                            {% if section.weight_or_percentage %}
                                <a href="{{ url_for('delete_topic_percentage_view', id=topic.id) }}" class="btn btn-sm btn-outline-danger">Delete</a>
                            {% else %}
                                <form method="POST" action="{{ url_for('delete_topic_direct', id=topic.id) }}" style="display: inline;">
                                    <button type="submit" class="btn btn-sm btn-outline-danger">Delete</button>
                                </form>
                            {% endif %}
                            
                            <a href="{{ url_for('list_activities', topic_id=topic.id) }}" class="btn btn-sm btn-outline-info">Activities</a>
                        </div>
                    </div>
                {% endfor %}
                <a href="{{ url_for('create_topic', course_id=course.id, section_id=section.id) }}" class="btn btn-success btn-sm mt-2">Create Topic</a>
            </td>
            
            <td>
                <a href="{{ url_for('edit_section', section_id=section.id) }}" class="btn btn-warning btn-sm">Edit</a>
                <form action="{{ url_for('delete_section', section_id=section.id) }}" method="post" style="display:inline;">
                    <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                </form>
            </td>
            <td>
                <a href="{{ url_for('list_students_in_section', course_id=course.id, section_id=section.id) }}" class="btn btn-info btn-sm">View Enrolled Students</a>
                <form action="{{ url_for('enroll_student_in_section', course_id=course.id, section_id=section.id) }}" method="post" style="display:inline;">
                    <select name="user_id" class="form-control form-control-sm" required>
                        <option value="">Select Student</option>
                        {% for student in students %}
                            <option value="{{ student.id }}">{{ student.name }}</option>
                        {% endfor %}
                    </select>
                    <button type="submit" class="btn btn-success btn-sm">Enroll</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}